<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8' />
  <title>Corona Testmöglichkeiten Köln</title>
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    button{
      margin: 0.2em
    }

    td, th {
      border: 1px solid #ddd;
      padding: 8px;
    }


    th {
      padding-top: 12px;
      padding-bottom: 12px;
      text-align: left;
      background-color: #4CAF50;
      color: white;
      }
  </style>
</head>

<body>
  <div id='map' style="padding: 2%;"></div>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZ2VvYnJ1bmkiLCJhIjoiY2tuNGdtODQ3MW95cTJ2cGMydG55NmVvZyJ9.r1c6ZZHO09sqjY7nf3z8lw';
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/geobruni/ckn4jrhbx1rx417mrzjft8nrl',
      center: [6.948101, 50.933858],
      zoom: 12
    });


    map.on('click', function (e) {
      var features = map.queryRenderedFeatures(e.point, {
        layers: ['testlocations-detailed'] // replace this with the name of the layer
      });

      if (!features.length) {
        return;
      }

      var feature = features[0];

      var popupDetails = new mapboxgl.Popup({offset: [0, 0], closeButton: false})
        .setLngLat(feature.geometry.coordinates)
        .setHTML(
          getPopupHtml(feature)      
        )
        .addTo(map);
    });

    function getPopupHtml(feature){
      var popupHtml = ''
      var title = '<h3>' + feature.properties.title + '</h3>'
      var address = '<p>' + feature.properties.address_street + ', ' + feature.properties.address_city + '</p>' 
      var buttonAppointment = (feature.properties.url_booking) ? '<button class="primary-btn" onclick="window.location.href=\'' +  feature.properties.url_booking + '\';">Termin buchen</button>' : ''
      var buttonGeneral = (feature.properties.url_info) ? '<button onclick="window.location.href=\'' + feature.properties.url_info + '\';">Details</button>' : ''
      popupHtml = title + address + buttonAppointment + buttonGeneral    
      return popupHtml
    };

  </script>
</body>

</html>